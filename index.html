<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trading Strategy Dashboard</title>
    <style>
        :root {
            --bg-primary: #0d1117;
            --bg-secondary: #161b22;
            --bg-card: #21262d;
            --text-primary: #f0f6fc;
            --text-secondary: #8b949e;
            --accent-green: #3fb950;
            --accent-red: #f85149;
            --accent-blue: #58a6ff;
            --accent-yellow: #d29922;
            --border: #30363d;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            padding: 2rem;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid var(--border);
        }

        header h1 {
            font-size: 1.75rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .last-updated {
            color: var(--text-secondary);
            font-size: 0.875rem;
        }

        .project {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 8px;
            margin-bottom: 2rem;
            overflow: hidden;
        }

        .project-header {
            padding: 1rem 1.5rem;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .project-header h2 {
            font-size: 1.25rem;
            font-weight: 600;
        }

        .project-meta {
            display: flex;
            gap: 0.75rem;
            align-items: center;
        }

        .status-badge {
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .status-badge.running {
            background: var(--accent-green);
            color: #000;
        }

        .status-badge.stopped {
            background: var(--accent-red);
            color: #fff;
        }

        .brokerage-badge {
            color: var(--text-secondary);
            font-size: 0.75rem;
        }

        /* Main stats row */
        .main-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 1rem;
            padding: 1.5rem;
            background: var(--bg-card);
        }

        .main-stat {
            text-align: center;
        }

        .main-stat-value {
            font-size: 1.75rem;
            font-weight: 700;
            margin-bottom: 0.25rem;
        }

        .main-stat-label {
            color: var(--text-secondary);
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        /* Performance metrics */
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 1rem;
            padding: 1.5rem;
        }

        .metric-card {
            background: var(--bg-card);
            border-radius: 6px;
            padding: 1rem;
            text-align: center;
        }

        .metric-label {
            color: var(--text-secondary);
            font-size: 0.75rem;
            margin-bottom: 0.5rem;
        }

        .metric-value {
            font-size: 1.25rem;
            font-weight: 600;
        }

        .metric-value.positive {
            color: var(--accent-green);
        }

        .metric-value.negative {
            color: var(--accent-red);
        }

        .metric-value.neutral {
            color: var(--text-secondary);
        }

        /* Holdings section */
        .holdings-section {
            padding: 1.5rem;
            border-top: 1px solid var(--border);
        }

        .holdings-title {
            font-size: 0.875rem;
            color: var(--text-secondary);
            margin-bottom: 1rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .holdings-table {
            width: 100%;
            border-collapse: collapse;
        }

        .holdings-table th,
        .holdings-table td {
            padding: 0.75rem;
            text-align: left;
            border-bottom: 1px solid var(--border);
        }

        .holdings-table th {
            color: var(--text-secondary);
            font-size: 0.75rem;
            text-transform: uppercase;
            font-weight: 500;
        }

        .holdings-table td {
            font-size: 0.875rem;
        }

        .no-holdings {
            color: var(--text-secondary);
            font-style: italic;
        }

        /* All stats expandable */
        .all-stats-section {
            padding: 1.5rem;
            border-top: 1px solid var(--border);
        }

        .all-stats-toggle {
            background: var(--bg-card);
            border: 1px solid var(--border);
            color: var(--text-secondary);
            padding: 0.5rem 1rem;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.875rem;
            width: 100%;
            text-align: left;
        }

        .all-stats-toggle:hover {
            background: var(--border);
        }

        .all-stats-content {
            display: none;
            margin-top: 1rem;
        }

        .all-stats-content.show {
            display: block;
        }

        .all-stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 0.5rem;
        }

        .all-stat-item {
            display: flex;
            justify-content: space-between;
            padding: 0.5rem;
            background: var(--bg-card);
            border-radius: 4px;
            font-size: 0.8rem;
        }

        .all-stat-key {
            color: var(--text-secondary);
        }

        .all-stat-value {
            font-weight: 500;
        }

        /* Footer */
        footer {
            text-align: center;
            padding: 2rem;
            color: var(--text-secondary);
            font-size: 0.875rem;
        }

        /* No data state */
        .no-data {
            text-align: center;
            padding: 4rem;
            color: var(--text-secondary);
        }

        .no-data h2 {
            margin-bottom: 1rem;
        }

        /* Launched date */
        .launched-date {
            color: var(--text-secondary);
            font-size: 0.75rem;
            padding: 0 1.5rem 1rem;
        }

        @media (max-width: 768px) {
            body {
                padding: 1rem;
            }

            .main-stats {
                grid-template-columns: repeat(2, 1fr);
            }

            .main-stat-value {
                font-size: 1.25rem;
            }

            .metrics-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Trading Strategy Dashboard</h1>
            <p class="last-updated" id="lastUpdated">Loading...</p>
        </header>

        <main id="dashboardContent">
            <div class="no-data">
                <h2>Loading dashboard data...</h2>
            </div>
        </main>

        <footer>
            <p>Data sourced from QuantConnect. Dashboard updates automatically via GitHub Actions.</p>
        </footer>
    </div>

    <script>
        function formatCurrency(value) {
            if (value === null || value === undefined || isNaN(value)) return '$0.00';
            return '$' + value.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
        }

        function formatPercent(value) {
            if (value === null || value === undefined || isNaN(value) || value === 0) return 'N/A';
            const sign = value >= 0 ? '+' : '';
            return `${sign}${value.toFixed(2)}%`;
        }

        function formatNumber(value, decimals = 2) {
            if (value === null || value === undefined || isNaN(value) || value === 0) return 'N/A';
            return value.toFixed(decimals);
        }

        function getValueClass(value, invert = false) {
            if (value === null || value === undefined || isNaN(value) || value === 0) return 'neutral';
            if (invert) return value <= 0 ? 'positive' : 'negative';
            return value >= 0 ? 'positive' : 'negative';
        }

        function renderProject(project, index) {
            const live = project.live;
            if (!live) return '';

            const statusClass = live.status === 'Running' ? 'running' : 'stopped';

            // Holdings table
            let holdingsHtml = '<p class="no-holdings">No open positions</p>';
            if (live.holdings && live.holdings.length > 0) {
                holdingsHtml = `
                    <table class="holdings-table">
                        <thead>
                            <tr>
                                <th>Symbol</th>
                                <th>Quantity</th>
                                <th>Avg Price</th>
                                <th>Market Value</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${live.holdings.map(h => `
                                <tr>
                                    <td>${h.symbol}</td>
                                    <td>${h.quantity.toLocaleString()}</td>
                                    <td>${formatCurrency(h.avgPrice)}</td>
                                    <td>${formatCurrency(h.marketValue)}</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                `;
            }

            // All stats
            let allStatsHtml = '';
            if (live.allStats && Object.keys(live.allStats).length > 0) {
                const statsItems = Object.entries(live.allStats)
                    .map(([key, value]) => `
                        <div class="all-stat-item">
                            <span class="all-stat-key">${key}</span>
                            <span class="all-stat-value">${value}</span>
                        </div>
                    `).join('');

                allStatsHtml = `
                    <div class="all-stats-section">
                        <button class="all-stats-toggle" onclick="toggleStats(${index})">
                            Show All Statistics
                        </button>
                        <div class="all-stats-content" id="stats-${index}">
                            <div class="all-stats-grid">
                                ${statsItems}
                            </div>
                        </div>
                    </div>
                `;
            }

            return `
                <div class="project">
                    <div class="project-header">
                        <h2>${project.name}</h2>
                        <div class="project-meta">
                            ${live.brokerage ? `<span class="brokerage-badge">${live.brokerage}</span>` : ''}
                            <span class="status-badge ${statusClass}">${live.status}</span>
                        </div>
                    </div>

                    ${live.launched ? `<p class="launched-date">Launched: ${new Date(live.launched).toLocaleString()}</p>` : ''}

                    <div class="main-stats">
                        <div class="main-stat">
                            <div class="main-stat-value">${formatCurrency(live.equity)}</div>
                            <div class="main-stat-label">Total Equity</div>
                        </div>
                        <div class="main-stat">
                            <div class="main-stat-value ${getValueClass(live.netProfit)}">${formatCurrency(live.netProfit)}</div>
                            <div class="main-stat-label">Net Profit</div>
                        </div>
                        <div class="main-stat">
                            <div class="main-stat-value ${getValueClass(live.totalReturn)}">${formatPercent(live.totalReturn)}</div>
                            <div class="main-stat-label">Return</div>
                        </div>
                        <div class="main-stat">
                            <div class="main-stat-value">${live.totalTrades || 0}</div>
                            <div class="main-stat-label">Total Trades</div>
                        </div>
                    </div>

                    <div class="metrics-grid">
                        <div class="metric-card">
                            <div class="metric-label">Cash</div>
                            <div class="metric-value">${formatCurrency(live.cash)}</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-label">Holdings Value</div>
                            <div class="metric-value">${formatCurrency(live.holdingsValue)}</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-label">Starting Capital</div>
                            <div class="metric-value">${formatCurrency(live.startingCapital)}</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-label">Sharpe Ratio</div>
                            <div class="metric-value ${getValueClass(live.sharpeRatio)}">${formatNumber(live.sharpeRatio)}</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-label">Max Drawdown</div>
                            <div class="metric-value ${getValueClass(live.maxDrawdown, true)}">${formatPercent(live.maxDrawdown)}</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-label">Win Rate</div>
                            <div class="metric-value ${getValueClass(live.winRate)}">${formatPercent(live.winRate)}</div>
                        </div>
                    </div>

                    <div class="holdings-section">
                        <h3 class="holdings-title">Current Holdings</h3>
                        ${holdingsHtml}
                    </div>

                    ${allStatsHtml}
                </div>
            `;
        }

        function toggleStats(index) {
            const content = document.getElementById(`stats-${index}`);
            const button = content.previousElementSibling;
            if (content.classList.contains('show')) {
                content.classList.remove('show');
                button.textContent = 'Show All Statistics';
            } else {
                content.classList.add('show');
                button.textContent = 'Hide Statistics';
            }
        }

        async function loadDashboard() {
            try {
                const response = await fetch('data/dashboard.json');
                if (!response.ok) throw new Error('Failed to load data');

                const data = await response.json();

                // Update timestamp
                const lastUpdated = document.getElementById('lastUpdated');
                if (data.generated) {
                    const date = new Date(data.generated);
                    lastUpdated.textContent = `Last updated: ${date.toLocaleString()}`;
                }

                // Render projects
                const content = document.getElementById('dashboardContent');

                if (!data.projects || data.projects.length === 0) {
                    content.innerHTML = `
                        <div class="no-data">
                            <h2>No Live Algorithms Found</h2>
                            <p>No running paper trading or live algorithms detected.</p>
                        </div>
                    `;
                    return;
                }

                content.innerHTML = data.projects.map((p, i) => renderProject(p, i)).join('');

            } catch (error) {
                console.error('Error loading dashboard:', error);
                document.getElementById('dashboardContent').innerHTML = `
                    <div class="no-data">
                        <h2>Error Loading Dashboard</h2>
                        <p>Could not load data/dashboard.json</p>
                        <p style="margin-top: 1rem; font-family: monospace; color: #f85149;">${error.message}</p>
                    </div>
                `;
            }
        }

        document.addEventListener('DOMContentLoaded', loadDashboard);
    </script>
</body>
</html>
